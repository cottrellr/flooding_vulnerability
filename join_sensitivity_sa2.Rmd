---
title: "Join sensitivity data to SA2"
author: "Catherine Kim"
date: "27/06/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
library(sf)
library(tidyverse)
library(janitor)
library(here)
library(rmapshaper)

library(ozmaps)
```

## Sensitivity - join these to SA2 polygons Catherine

Ave elevation for SA2s - Rich aggregate to SA2 level
Demographic data
Power
Dwelling type, proportion of total dwellings

Read in files and plot

```{r echo=FALSE}
bris_sa2 <- st_read(here('data/spatial/sa2_2016_aust_shape/SA2_2016_AUST.shp')) %>% 
  filter(GCC_NAME16 == "Greater Brisbane") %>% 
  select(SA2_NAME16, geometry)

ggplot() +
  geom_sf(data = bris_sa2) +
  theme_bw() +
  theme(legend.position = "none")
```

## Read in sensitivity data

### Dwelling type

```{r }
library(zoo)
dwell <- read_csv('data/raw_data/dwelling_type_R.csv') %>% 
  na.locf(fromLast=FALSE) %>% 
  clean_names()
glimpse(dwell)
names(dwell)
dwell
```

```{r}
(prop_house <- dwell %>% 
  select(sa2, hhcd_1_digit_level, separate_house , total) %>% 
  filter(hhcd_1_digit_level == "Total") %>% 
  mutate(prop_house = separate_house / total)) 

skim(prop_house)

# returns tibble
prop_house%>% 
  full_join(bris_sa2, by = c('sa2' = 'SA2_NAME16'))

write.csv(prop_house, 'data/processed_data/dwell_house.csv', row.names = FALSE)
```

```{r }
prop_house_sf <- merge(bris_sa2, prop_house, all = TRUE)

st_write(prop_house_sf, 'data/)

```

## Plot w proportion of seaparate houses

```{r}
ggplot() +
  geom_sf(data = prop_house_sf, aes(fill = prop_house)) +
  theme_bw() 
+
  theme(legend.position = "none")
```

