---
title: "Combine spatial layers"
author: "Rich Cottrell"
date: "11/03/2022"
output: html_document
---

```{r}
library(sf)
library(tidyverse)
library(janitor)
library(here)
library(rmapshaper)

library(ozmaps)
```

Flood awareness extent from Brisbane City Council
```{r}

flood_extents_shp <- st_read(here("data/spatial/Flood__Awareness__Extents/Flood___Awareness___Extents.shp"))


ggplot()+
  geom_sf(data = flood_extents_shp, fill="lightblue", colour = "grey90", size = 0.01)+
  theme_bw()


```
Historic event extents - read and plot for vis

```{r}

flood_1893 <- st_read(here("data/spatial/QSC_1893/Flood_extent_polygon___February_1893___Brisbane_and_Bremer_Rivers.shp")) 

flood_1974 <- st_read(here("data/spatial/QSC_1974/Flood_extent___Brisbane_and_Ipswich___1974.shp"))

flood_2011 <- st_read(here("data/spatial/QSC_2011/Flood_extent___Queensland___Jan_2011.shp"))

flood_2011 <- st_make_valid(flood_2011)




ggplot()+
  geom_sf(data = flood_2011, fill="lightblue", size = 0.01)

ggplot()+
  geom_sf(data=flood_1893, fill="lightblue", size=0.01)

ggplot()+
  geom_sf(data = flood_1974, fill="lightblue", size=0.01)

#sf_use_s2(TRUE)
flood_1893_1974 <- st_union(flood_1893, flood_1974)

flood_1893_1974_2011 <- st_union(flood_1893, flood_1974, flood_2011)

ggplot()+
  geom_sf(data = flood_1893_1974_2011, fill="lightblue", size=0.01)

```

#Brisbane admin regions   

```{r}

lgas <- ozmaps::ozmap_data(data = "abs_lga")

unique(lgas$NAME)[grep("Brisbane", unique(lgas$NAME))]

bris_lga <- lgas %>% filter(NAME == "Brisbane (C)" )



```


#get the intersection brisbane LGA and the joined flood exposure
```{r}

floods_within_lga <- st_intersection(bris_lga, flood_1893_1974_2011)



ggplot()+
  geom_sf(data = floods_within_lga, 
          fill= "lightblue", size=NA)+
  theme_bw()


ggsave(here("explore", "cottrell_explore", "flood exposure-1893-1974-2011.jpg"), dpi = 300, width = 18, height = 11, units = "cm")

```

Get major water ways data
```{r}

watercourse <- st_read(here("data/spatial/major_waterways/Major_watercourse_lines.shp"))

bris_watercourse <- watercourse %>% filter(NAME == "Brisbane River") 

ggplot()+
  geom_sf(data= bris_watercourse)


```

Get the SA2 data
```{r}

SA2_aus <- st_read(here("data/spatial/sa2_2016_aust_shape/SA2_2016_AUST.shp"))

SA2_bris <- SA2_aus %>% filter(STE_NAME16 == "Queensland" & GCC_NAME16 == "Greater Brisbane")

ggplot()+
  geom_sf(data= SA2_bris)

SA2_bris_lga <- st_intersection(SA2_bris, bris_lga)

SA2_bris_lga <- sf::st_crop(x = SA2_bris_lga, st_bbox(floods_within_lga)) 

ggplot()+
  geom_sf(data = SA2_bris_lga)

ggplot()+
  geom_sf(data= SA2_bris_lga, size= 0.1)+
  geom_sf(data = floods_within_lga, fill = "lightblue", colour = NA)+
  theme_bw()




```

Join income to SA2 polygons
```{r}





```

