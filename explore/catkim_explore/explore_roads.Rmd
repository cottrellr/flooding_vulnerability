---
title: "explore roads"
author: "Catherine Kim"
date: "04/04/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Queensland Roads & Tracks shapefile

Exploring the QLD roads and tracks data

```{r cars}
library(sf)
library(tidyverse)
library(here)
library(ozmaps)

roads <- read_sf(here('data/spatial/QLD_Roads_Tracks.gdb')) # tibble
st_crs(roads)
roads

# plot(roads) # plots all columns

# plot geometry
plot(st_geometry(roads))
```

## Focus on Brisbane

### LGA

```{r pressure, echo=FALSE}
(roads$LGA_NAME_LEFT)

# as a factor
roads$LGA_NAME_LEFT <- as.factor(roads$LGA_NAME_LEFT)
roads$LGA_NAME_RIGHT <- as.factor(roads$LGA_NAME_RIGHT)
```

GEO_DATUM AND V_DATUM are all the same for Brisbane

```{r subset Brisbane City adjacent LGAs}
BC_roads <- roads %>% 
  select(LGA_NAME_LEFT, LGA_NAME_RIGHT, GROUND_REL, POS_ACCURACY) %>% 
    filter( LGA_NAME_LEFT == 'Brisbane City',
             LGA_NAME_RIGHT == 'Brisbane City') 
BC_roads
```

Some roads labelled as Brisbane City far away from Brisbane.

```{r}
plot(st_geometry(BC_roads))

levels(droplevels(BC_roads$LGA_NAME_LEFT)) # check just Brisbane
levels(droplevels(BC_roads$LGA_NAME_RIGHT))
```

Remove water roads.

```{r}
BC_roads$GROUND_REL

BC_nowater <- BC_roads %>% filter(GROUND_REL != "Water")

ggplot(BC_nowater) + geom_sf()
```

### Crop using LGA shapefile

```{r lgas}
lgas <- ozmaps::ozmap_data(data = "abs_lga")

bris_lga <- lgas %>% filter(NAME == unique(lgas$NAME)[grep("Brisbane", unique(lgas$NAME))])

bris_lga_bbox <- st_bbox(bris_lga)
```

```{r crop to brisbane}
bris_roads <- st_crop(roads, bris_lga_bbox) %>% 
  select(LGA_NAME_LEFT, LGA_NAME_RIGHT, GROUND_REL, POS_ACCURACY)

plot(bris_roads) # plot all 4 cols

ggplot(bris_roads) +
  geom_sf(aes(color = LGA_NAME_RIGHT))
```

### Overlay 2011 flood awareness maps

Read in flood extent from Brisbane City Council.

```{r}
flood_extents_shp <- st_read(here("data/spatial/Flood__Awareness__Extents/Flood___Awareness___Extents.shp"))

ggplot()+
  geom_sf(data = flood_extents_shp, fill="lightblue", colour = "grey90", size = 0.01)+
  theme_bw()
```

Plot both flood extent and roads.

```{r}
ggplot()+
  geom_sf(data = bris_roads) +
  geom_sf(data = flood_extents_shp, fill="lightblue", colour = "grey90", size = 0.01)+
  theme_bw()
```

## Statistical Area (SA) 2

Read in SA data from Rich's code

```{r}
SA2_aus <- st_read(here("data/spatial/sa2_2016_aust_shape/SA2_2016_AUST.shp"))

SA2_bris <- SA2_aus %>% filter(STE_NAME16 == "Queensland" & GCC_NAME16 == "Greater Brisbane")

SA2_bris$SA2_NAME16

ggplot()+
  geom_sf(data= SA2_bris)
```

Crop roads with SA2 shapefile.

```{r}
bris_sa2 <- st_crop(BC_nowater, SA2_bris)
class(bris_sa2)
#save(bris_sa2, file = here("data/processed_data/bris_roads_SA2.Rdata"))

ggplot(bris_sa2) + geom_sf() +
    geom_sf(data = flood_extents_shp, fill="lightblue", colour = "grey90",
            size = 0.01, alpha = 0.5) +
  theme_bw()
```

